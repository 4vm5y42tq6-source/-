<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç‰§å ´ã‚¯ã‚¨ã‚¹ãƒˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:sans-serif;background:linear-gradient(#1a237e,#000);color:#fff}
h1,h2{text-align:center}
.screen{display:none;padding:15px}
.active{display:block}
.panel{background:rgba(0,0,0,.6);padding:15px;border-radius:12px;margin-bottom:12px}
button{width:100%;padding:14px;font-size:16px;border-radius:10px;border:none;background:#ffca28;font-weight:bold;margin-bottom:8px}
.bar{background:#333;border-radius:10px;overflow:hidden}
.bar-inner{height:16px;background:#66bb6a}
.small{text-align:center;font-size:12px;color:#ccc}
.mon{border-bottom:1px solid #444;padding:6px 0}
</style>
</head>
<body>

<!-- HOME -->
<div id="home" class="screen active">
<h1>ğŸ² ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç‰§å ´ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
<div class="panel">
Lv <span id="h_lv"></span><br>
æ”»æ’ƒåŠ› <span id="h_atk"></span><br>
ğŸ’° <span id="h_gold"></span> G
</div>
<button onclick="go('battle')">ğŸŒ² å†’é™º</button>
<button onclick="go('farm')">ğŸ¾ ç‰§å ´</button>
<button onclick="go('fusion')">ğŸ”® åˆæˆ</button>
<button onclick="go('book')">ğŸ“– å›³é‘‘</button>
</div>

<!-- BATTLE -->
<div id="battle" class="screen">
<h2>ğŸŒ² å†’é™ºä¸­</h2>
<div class="panel">
Lv <span id="lv"></span> EXP <span id="exp"></span>/<span id="next"></span>
<div class="bar"><div id="expBar" class="bar-inner"></div></div>
</div>
<div class="panel">
ğŸ‘¾ <span id="m_name"></span><br>
HP <span id="m_hp"></span>
<div class="bar"><div id="hpBar" class="bar-inner" style="background:#ef5350"></div></div>
</div>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<!-- FARM -->
<div id="farm" class="screen">
<h2>ğŸ¾ ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ç‰§å ´</h2>
<div id="farmList" class="panel"></div>
<button onclick="collect()">ğŸ’° åç©«</button>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<!-- FUSION -->
<div id="fusion" class="screen">
<h2>ğŸ”® ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼åˆæˆ</h2>
<div id="fusionList" class="panel"></div>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<!-- BOOK -->
<div id="book" class="screen">
<h2>ğŸ“– ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å›³é‘‘</h2>
<div id="bookList" class="panel"></div>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<script>
let hero={lv:1,exp:0,next:10,atk:1};
let gold=0,lastTime=Date.now();
let monsters=[
{name:"ã‚¹ãƒ©ã‚¤ãƒ ã‚‚ã©ã",hp:10,exp:5,g:3,rate:0.3,earn:1},
{name:"ã‚´ãƒ–ãƒªãƒ³é¢¨",hp:30,exp:12,g:8,rate:0.25,earn:3},
{name:"ãƒ‰ãƒ©ã‚­ãƒ¼ä¼¼",hp:60,exp:25,g:15,rate:0.2,earn:6},
{name:"ãƒ¡ã‚¿ãƒ«å½±",hp:120,exp:80,g:50,rate:0.1,earn:20},
{name:"å¤ä»£é­”ç£",hp:300,exp:200,g:150,rate:0.05,earn:50}
];
let monster={},farm=[],book={},interval;

function save(){
localStorage.setItem("farmSave",JSON.stringify({hero,gold,farm,book,lastTime}));
}
function load(){
let s=localStorage.getItem("farmSave");
if(!s)return;
let d=JSON.parse(s);
hero=d.hero;gold=d.gold;farm=d.farm;book=d.book;
let diff=Math.floor((Date.now()-d.lastTime)/1000);
farm.forEach(m=>gold+=m.earn*diff);
}

function go(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
if(id==="battle") start();
if(id==="farm") updateFarm();
if(id==="fusion") updateFusion();
if(id==="book") updateBook();
updateHome();
}

function back(){clearInterval(interval);save();go("home");}

function start(){spawn();interval=setInterval(attack,1000);}

function spawn(){
let m=monsters[Math.floor(Math.random()*monsters.length)];
monster={...m,maxHp:m.hp};
}

function attack(){
monster.hp-=hero.atk;
if(monster.hp<=0){
hero.exp+=monster.exp;
gold+=monster.g;
book[monster.name]=true;
if(Math.random()<monster.rate){
farm.push({name:monster.name,earn:monster.earn});
alert("ğŸ‰ "+monster.name+" ãŒä»²é–“ã«ãªã£ãŸï¼");
}
while(hero.exp>=hero.next){
hero.exp-=hero.next;hero.lv++;hero.atk++;hero.next=Math.floor(hero.next*1.5);
}
spawn();
}
updateBattle();
}

function collect(){
farm.forEach(m=>gold+=m.earn*10);
alert("ğŸ’° åç©«å®Œäº†ï¼");
}

function updateHome(){
h_lv.textContent=hero.lv;
h_atk.textContent=hero.atk;
h_gold.textContent=gold;
}

function updateBattle(){
lv.textContent=hero.lv;
exp.textContent=hero.exp;
next.textContent=hero.next;
m_name.textContent=monster.name;
m_hp.textContent=monster.hp;
expBar.style.width=(hero.exp/hero.next*100)+"%";
hpBar.style.width=(monster.hp/monster.maxHp*100)+"%";
}

function updateFarm(){
farmList.innerHTML="";
farm.forEach(m=>farmList.innerHTML+=`<div class="mon">ğŸ¾ ${m.name} +${m.earn}G/s</div>`);
}

function updateFusion(){
fusionList.innerHTML="";
let count={};
farm.forEach(m=>count[m.name]=(count[m.name]||0)+1);
Object.keys(count).forEach(n=>{
if(count[n]>=3){
fusionList.innerHTML+=`<button onclick="fuse('${n}')">ğŸ”® ${n} åˆæˆ</button>`;
}
});
}

function fuse(name){
let used=0;
farm=farm.filter(m=>{
if(m.name===name && used<3){used++;return false;}
return true;
});
farm.push({name:"å¼·åŒ–"+name,earn:10});
alert("âœ¨ åˆæˆæˆåŠŸï¼");
updateFusion();
}

function updateBook(){
bookList.innerHTML="";
monsters.forEach(m=>{
bookList.innerHTML+=book[m.name]?`ğŸ‘¾ ${m.name}<br>`:`â“ æœªç™ºè¦‹<br>`;
});
}

load();updateHome();
</script>
</body>
</html>
