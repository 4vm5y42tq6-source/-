<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>The hours</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f2f4f7;
}

header {
  padding: 15px;
  text-align: center;
  font-size: 26px;
  font-weight: bold;
  background: white;
}

.status {
  background: #eee;
  margin: 10px;
  padding: 10px;
  border-radius: 10px;
}

.big {
  margin: 10px;
  text-align: center;
}

.big button {
  width: 100%;
  font-size: 24px;
  padding: 15px;
  border-radius: 15px;
  border: none;
}

.big button:disabled {
  background: #ccc;
}

.tabs {
  display: flex;
  gap: 5px;
  margin: 10px;
}

.tabs button {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: none;
}

.tabs button.active {
  background: #2b7bb9;
  color: white;
}

.tab {
  display: none;
  margin: 10px;
}

.tab.active {
  display: block;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 10px;
  margin-bottom: 10px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.monster {
  text-align: center;
}

.monster img {
  width: 90px;
  height: 90px;
  object-fit: contain;
}

.rare { color: gold; font-weight: bold; }
.super { color: crimson; font-weight: bold; }

.slot {
  font-size: 40px;
  text-align: center;
}

button.main {
  width: 100%;
  padding: 15px;
  font-size: 20px;
  border-radius: 15px;
  border: none;
  background: #e74c3c;
  color: white;
}
</style>
</head>

<body>

<header>The hours</header>

<div class="status">
ğŸ’° é‡‘è²¨: <span id="coin">0</span><br>
ğŸ“ˆ åç›Š: <span id="income">0</span>/ç§’
</div>

<div class="big">
  <div id="timer">èª­ã¿è¾¼ã¿ä¸­...</div>
  <button id="getBtn" disabled>GETã™ã‚‹</button>
</div>

<div class="tabs">
  <button onclick="openTab('storage')" class="active">å€‰åº«</button>
  <button onclick="openTab('book')">å›³é‘‘</button>
  <button onclick="openTab('slot')">ã‚¹ãƒ­ãƒƒãƒˆ</button>
</div>

<!-- å€‰åº« -->
<div id="storage" class="tab active">
  <div id="storageList" class="grid"></div>
</div>

<!-- å›³é‘‘ -->
<div id="book" class="tab">
  <div id="bookList" class="grid"></div>
</div>

<!-- ã‚¹ãƒ­ãƒƒãƒˆ -->
<div id="slot" class="tab">
  <div class="card">
    <h3>ğŸ° ã‚¹ãƒ­ãƒƒãƒˆ</h3>
    <div class="slot">
      <span id="s1">â“</span>
      <span id="s2">â“</span>
      <span id="s3">â“</span>
    </div>
    <p>1å›ï¼š100,000é‡‘</p>
    <button class="main" onclick="spin()">å›ã™</button>
    <p id="slotResult"></p>
  </div>
</div>

<script>
// =======================
// ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å®šç¾©ï¼ˆAIçµµï¼‰
// =======================
const monsters = [
  {name:"ã‚¹ãƒ©ã‚¤ãƒ ", power:1, rarity:"N", img:"images/slime.png", rate:0.4},
  {name:"ã‚´ãƒ–ãƒªãƒ³", power:5, rarity:"N", img:"images/goblin.png", rate:0.3},
  {name:"ãƒ‰ãƒ©ã‚´ãƒ³", power:25, rarity:"R", img:"images/dragon.png", rate:0.2},
  {name:"ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹", power:80, rarity:"R", img:"images/phoenix.png", rate:0.09},
  {name:"å‰µä¸–ã®ç¥ç£", power:300, rarity:"SR", img:"images/godbeast.png", rate:0.01}
];

// =======================
// ã‚»ãƒ¼ãƒ–
// =======================
let save = JSON.parse(localStorage.getItem("save")) || {
  coin: 0,
  storage: [],
  lastGet: 0,
  lastTime: Date.now()
};

// =======================
// ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åç›Š
// =======================
(function(){
  let now = Date.now();
  let sec = Math.floor((now - save.lastTime)/1000);
  let income = save.storage.reduce((a,m)=>a+m.power,0);
  if(sec > 0 && income > 0){
    let gain = sec * income;
    save.coin += gain;
    alert(`ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åç›Šï¼š${gain.toLocaleString()}é‡‘ ç²å¾—ï¼`);
  }
  save.lastTime = now;
})();

function saveGame(){
  save.lastTime = Date.now();
  localStorage.setItem("save", JSON.stringify(save));
}

// =======================
// æ”¾ç½®åç›Š
// =======================
setInterval(()=>{
  let income = save.storage.reduce((a,m)=>a+m.power,0);
  save.coin += income;
  saveGame();
  update();
  updateTimer();
},1000);

// =======================
// GET
// =======================
function getMonster(){
  if(Date.now() - save.lastGet < 3600000) return;

  let r = Math.random();
  let sum = 0;
  let pick;
  for(let m of monsters){
    sum += m.rate;
    if(r < sum){
      pick = m;
      break;
    }
  }
  save.storage.push(pick);
  save.lastGet = Date.now();
  saveGame();
  update();
}

// =======================
// ã‚¿ã‚¤ãƒãƒ¼
// =======================
function updateTimer(){
  let diff = 3600000 - (Date.now() - save.lastGet);
  if(diff <= 0){
    timer.textContent = "GETå¯èƒ½ï¼";
    getBtn.disabled = false;
  } else {
    timer.textContent = "æ¬¡ã®GETã¾ã§ " + Math.ceil(diff/60000) + "åˆ†";
    getBtn.disabled = true;
  }
}

// =======================
// è¡¨ç¤º
// =======================
function update(){
  coin.textContent = save.coin.toLocaleString();
  income.textContent = save.storage.reduce((a,m)=>a+m.power,0);

  storageList.innerHTML = "";
  save.storage.forEach(m=>{
    storageList.innerHTML += `
      <div class="card monster">
        <img src="${m.img}">
        <b>${m.name}</b><br>
        +${m.power}/ç§’<br>
        <span class="${m.rarity==='SR'?'super':m.rarity==='R'?'rare':''}">
          ${m.rarity}
        </span>
      </div>`;
  });

  bookList.innerHTML = "";
  monsters.forEach(m=>{
    let c = save.storage.filter(s=>s.name===m.name).length;
    bookList.innerHTML += `
      <div class="card monster">
        <img src="${m.img}">
        <b>${m.name}</b><br>
        æ‰€æŒ: ${c}<br>
        ${m.rarity}
      </div>`;
  });
}

// =======================
// ã‚¹ãƒ­ãƒƒãƒˆ
// =======================
function spin(){
  if(save.coin < 100000){
    slotResult.textContent = "é‡‘ãŒè¶³ã‚Šãªã„";
    return;
  }
  save.coin -= 100000;

  let s=["ğŸ’","ğŸ‹","ğŸ‡"];
  let a=s[Math.floor(Math.random()*3)];
  let b=s[Math.floor(Math.random()*3)];
  let c=s[Math.floor(Math.random()*3)];
  s1.textContent=a; s2.textContent=b; s3.textContent=c;

  if(a===b && b===c){
    save.coin += 5000000;
    slotResult.textContent="ğŸ‰ å¤§å½“ãŸã‚Šï¼";
  } else {
    slotResult.textContent="ã¯ãšã‚Œ";
  }
  saveGame();
  update();
}

// =======================
function openTab(id){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  event.target.classList.add("active");
}

getBtn.onclick = getMonster;
update();
updateTimer();
</script>

</body>
</html>
