<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æ”¾ç½®å‹‡è€…ã‚¯ã‚¨ã‚¹ãƒˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:sans-serif;background:linear-gradient(#1a237e,#000);color:#fff}
h1,h2{text-align:center}
.screen{display:none;padding:15px}
.active{display:block}
.panel{background:rgba(0,0,0,.6);padding:15px;border-radius:12px;margin-bottom:12px}
button{width:100%;padding:14px;font-size:16px;border-radius:10px;border:none;background:#ffca28;font-weight:bold;margin-bottom:8px}
.bar{background:#333;border-radius:10px;overflow:hidden}
.bar-inner{height:16px;background:#66bb6a}
.rare{color:#4dd0e1}
.epic{color:#ce93d8}
.legend{color:#ffeb3b}
.small{font-size:12px;color:#ccc;text-align:center}
</style>
</head>
<body>

<div id="home" class="screen active">
<h1>ğŸ° æ”¾ç½®å‹‡è€…ã‚¯ã‚¨ã‚¹ãƒˆ</h1>
<div class="panel">
Lv <span id="h_lv"></span><br>
æ”»æ’ƒåŠ› <span id="h_atk"></span><br>
è»¢ç”Ÿ <span id="h_rebirth"></span><br>
ğŸ’° <span id="h_gold"></span> G<br>
â± æ”¾ç½®æ™‚é–“ <span id="offline"></span> ç§’
</div>
<button onclick="go('battle')">ğŸŒ² å†’é™º</button>
<button onclick="go('gacha')">ğŸº é…’å ´</button>
<button onclick="go('book')">ğŸ“– å›³é‘‘</button>
<button onclick="go('boss')">ğŸ° é­”ç‹åŸ</button>
</div>

<div id="battle" class="screen">
<h2>ğŸŒ² å†’é™ºä¸­</h2>
<div class="panel">
Lv <span id="lv"></span> / EXP <span id="exp"></span>/<span id="next"></span>
<div class="bar"><div id="expBar" class="bar-inner"></div></div>
</div>
<div class="panel">
ğŸ‘¾ <span id="m_name"></span><br>
HP <span id="m_hp"></span>
<div class="bar"><div id="hpBar" class="bar-inner" style="background:#ef5350"></div></div>
</div>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<div id="gacha" class="screen">
<h2>ğŸº é…’å ´</h2>
<div class="panel">
å¼·åŒ–è²»ç”¨ï¼š<span id="cost"></span> G<br><br>
<button onclick="upgrade()">ğŸ’ª æ”»æ’ƒåŠ›å¼·åŒ–</button>
</div>
<button onclick="rebirth()">ğŸ”„ è»¢ç”Ÿ</button>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<div id="book" class="screen">
<h2>ğŸ“– ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å›³é‘‘</h2>
<div id="bookList" class="panel"></div>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<div id="boss" class="screen">
<h2>ğŸ° é­”ç‹åŸ</h2>
<div class="panel">
é­”ç‹HP <span id="bossHp"></span>
<div class="bar"><div id="bossBar" class="bar-inner" style="background:red"></div></div>
</div>
<button onclick="fightBoss()">âš”ï¸ æŒ‘æˆ¦</button>
<button onclick="back()">ğŸ  æˆ»ã‚‹</button>
</div>

<script>
let hero={lv:1,exp:0,next:10,atk:1,rebirth:0};
let gold=0,lastTime=Date.now(),bossMax=1000,bossHp=bossMax;
let discovered={},interval,monster={};

const monsters=[
{name:"ã‚¹ãƒ©ã‚¤ãƒ ã‚‚ã©ã",hp:10,exp:5,g:3,r:"normal"},
{name:"ã‚´ãƒ–ãƒªãƒ³é¢¨",hp:30,exp:12,g:8,r:"normal"},
{name:"ãƒ‰ãƒ©ã‚­ãƒ¼ä¼¼",hp:60,exp:25,g:15,r:"rare"},
{name:"ãƒ¡ã‚¿ãƒ«å½±",hp:120,exp:80,g:50,r:"epic"},
{name:"å¤ä»£é­”ç£",hp:300,exp:200,g:150,r:"legend"}
];

function save(){
localStorage.setItem("idleSave",JSON.stringify({hero,gold,lastTime,bossHp,discovered}));
}
function load(){
let s=localStorage.getItem("idleSave");
if(!s)return;
let d=JSON.parse(s);
hero=d.hero; gold=d.gold; bossHp=d.bossHp; discovered=d.discovered||{};
let diff=Math.floor((Date.now()-d.lastTime)/1000);
gold+=diff*hero.atk;
offline.textContent=diff;
}

function go(id){
document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
if(id==="battle") start();
if(id==="book") updateBook();
updateHome();
}

function back(){clearInterval(interval);save();go("home");}

function start(){spawn();interval=setInterval(attack,1000);}

function spawn(){
let m=monsters[Math.floor(Math.random()*monsters.length)];
monster={...m,maxHp:m.hp};
}

function attack(){
monster.hp-=hero.atk;
if(monster.hp<=0){
hero.exp+=monster.exp;
gold+=monster.g;
discovered[monster.name]=monster.r;
while(hero.exp>=hero.next){
hero.exp-=hero.next;hero.lv++;hero.atk++;hero.next=Math.floor(hero.next*1.5);
}
spawn();
}
updateBattle();
}

function upgrade(){
let c=hero.atk*50;
if(gold<c)return alert("Gä¸è¶³");
gold-=c;hero.atk++;
}

function rebirth(){
if(hero.lv<20)return alert("Lv20å¿…è¦");
hero={lv:1,exp:0,next:10,atk:1+hero.rebirth*3,rebirth:hero.rebirth+1};
gold=0;
}

function fightBoss(){
bossHp-=hero.atk*10;
if(bossHp<=0){alert("é­”ç‹æ’ƒç ´ï¼");gold+=1000;bossMax+=500;bossHp=bossMax;}
bossHpSpan=bossHp;
}

function updateHome(){
h_lv.textContent=hero.lv;
h_atk.textContent=hero.atk;
h_rebirth.textContent=hero.rebirth;
h_gold.textContent=gold;
cost.textContent=hero.atk*50;
}

function updateBattle(){
lv.textContent=hero.lv;
exp.textContent=hero.exp;
next.textContent=hero.next;
m_name.textContent=monster.name;
m_hp.textContent=monster.hp;
expBar.style.width=(hero.exp/hero.next*100)+"%";
hpBar.style.width=(monster.hp/monster.maxHp*100)+"%";
}

function updateBook(){
bookList.innerHTML="";
monsters.forEach(m=>{
let r=discovered[m.name];
bookList.innerHTML+=r?`<div class="${r}">ğŸ‘¾ ${m.name}</div>`:"â“ æœªç™ºè¦‹";
});
}

load();updateHome();
</script>
</body>
</html>
